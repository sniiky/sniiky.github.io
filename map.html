<!DOCTYPE html>
<html lang="ja">

<head>
  <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
  <meta charset="utf-8">
  <title>My Map</title>
  <style>
    #target {
      width: 500px;
      height: 350px;
      float: left;
      margin-right: 10px
    }

    .top {
      cursor: pointer;
      /* border: inset 10px #ff0000; */
      display: inline-block;
      /* padding:5px; */
      padding: 0.5em 1em;
      /* margin: 2em 0; */
      color: #00BCD4;
      background: #e4fcff;
      /*背景色*/
      border-top: solid 6px #1dc1d6;
      box-shadow: 0 3px 4px rgba(0, 0, 0, 0.32);
      /*影*/
    }

    .top:hover {
      opacity: 0.8;
      background: #ddd;
    }

    .result,
    .result2 {
      display: inline-grid;
    }
  </style>
</head>

<body>
  <div id="target"></div>

  <!-- <ul id="info">
    <li>
      COCO HOUSE
    </li>
  </ul> -->

  <input type="text" id="address" placeholder="type address!">
  <button id="search">Search</button>

  <p id="result">Click to 緯度</p>
  <p id="result2">Click to 経度</p>
  <!-- <i class="fas fa-align-justify"></i> -->
  <a href="index.html">
    <div class="top">top page</div>
  </a>

  <script
    src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=AIzaSyCLQ82FGvykwMLGP5XQmmc0ubFwsjMYMK0&callback=initMap"
    async defer></script>
  <script>
    function initMap() {
      'use strict';

      const target = document.getElementById('target');
      const tarama = { lat: 24.668682100707706, lng: 124.70253061782172 };
      let map;
      let marker;
      let infoWindow;

      map = new google.maps.Map(target, {
        center: tarama,
        zoom: 16,
        disableDefaultUI: true,
        zoomControl: true,
        // mapTypeId: 'satellite'
        mapTypeId: 'hybrid',
        clickableIcons: false,
      });

      marker = new google.maps.Marker({
        position: tarama,
        map: map,
        // icon: {
        //   url: 'image/Pin.png',
        //   scaledSize: new google.maps.Size(29, 29)
        // },
        animation: google.maps.Animation.BOUNCE,
        // animation: google.maps.Animation.DROP,
      });


      infoWindow = new google.maps.InfoWindow({
        position: tarama,
        content: 'COCO HOUSE',
        maxWidth: 100,
      });

      infoWindow.open(map);


      const result = document.getElementById('result')
      const result2 = document.getElementById('result2')

      map.addListener('click', (e) => {
        result.textContent = `緯度は:${e.latLng.lat()}です`;
        result2.textContent = `経度は:${e.latLng.lng()}です`;
        console.log(e.latLng.toString());
        // map.setCenter(e.latLng);
        map.panTo(e.latLng);

        marker = new google.maps.Marker({
          // position: e.latLng,
          map: map,
          title: e.latLng.toString(),
          animation: google.maps.Animation.BOUNCE,
          // animation: google.maps.Animation.DROP,
        });

        marker.addListener('click', () => {
          marker.setMap(null);
        });

        geocoder.geocode({
          location: e.latLng,
        }, function (results, status) {
          if (status !== 'OK') {
            alert('Failed: ' + status)
            return;
          }
          if (results[0]) {
            const marker2 = new google.maps.Marker({
              position: e.latLng,
              map: map,
              title: results[0].formatted_address,
              animation: google.maps.Animation.DROP,
            });
            marker2.addListener('click', () => {
              marker2.setMap(null);
            });

          } else {
            alert('No result');
            return;
          }
          // results[0].formatted_address
        })


      });

      // Geocoding
      const search = document.getElementById('search');
      const address = document.getElementById('address');
      const geocoder = new google.maps.Geocoder();

      search.addEventListener('click', () => {
        geocoder.geocode({
          address: document.getElementById('address').value
        }, function (results, status) {
          if (status !== 'OK') {
            alert('Failed: ' + status);
            return;
          }
          // results[0].geometry.location
          if (results[0]) {
            new google.maps.Map(target, {
              center: results[0].geometry.location,
              zoom: 15
            });
          } else {
            alert('No results found');
            return;
          }
        });
      });




    }
  </script>
</body>

</html>